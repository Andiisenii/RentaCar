<!DOCTYPE html>
<html lang="sq">
<head>
    <meta charset="UTF-8" />
    <title>Rezervim Makine - {{ car.brand }} {{ car.model }}</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css" />
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
        background: #f9f9f9;
      }
      .car-container {
        max-width: 900px;
        margin: auto;
        background: white;
        border-radius: 8px;
        padding: 20px;
        box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        animation: fadeIn 1s ease;
      }
      .car-title {
        font-size: 2em;
        margin-bottom: 10px;
        text-align: center;
      }
      .carousel {
        position: relative;
        max-width: 600px;
        margin: 10px auto 30px;
        overflow: hidden;
        border-radius: 10px;
      }
      .carousel img {
        width: 100%;
        display: none;
        transition: opacity 0.5s ease-in-out;
      }
      .carousel img.active {
        display: block;
        opacity: 1;
      }
      .carousel-buttons {
        text-align: center;
        margin-top: 10px;
      }
      .carousel-buttons button {
        margin: 0 5px;
        padding: 6px 12px;
        font-size: 1em;
        cursor: pointer;
        border-radius: 5px;
        border: none;
        background-color: #3498db;
        color: white;
        transition: background-color 0.3s ease;
      }
      .carousel-buttons button:hover {
        background-color: #2980b9;
      }
      .description {
        padding: 0 10px;
        margin-bottom: 20px;
        font-size: 1.1em;
        color: #555;
      }
      form label {
        display: block;
        margin-top: 10px;
        font-weight: bold;
      }
      form input, form select {
        width: 100%;
        padding: 8px;
        margin-top: 5px;
        box-sizing: border-box;
        font-size: 1em;
      }
      form button {
        margin-top: 20px;
        background-color: #27ae60;
        border: none;
        color: white;
        padding: 12px 20px;
        font-size: 1.2em;
        cursor: pointer;
        border-radius: 5px;
        width: 100%;
      }
      form button:hover {
        background-color: #1e8449;
      }
      .total-price {
        margin-top: 15px;
        font-weight: bold;
        font-size: 1.3em;
        color: #e74c3c;
      }
      @keyframes fadeIn {
        from {opacity: 0;}
        to {opacity: 1;}
      }
    </style>
</head>
<body>
<div class="car-container">
    <h1 class="car-title">{{ car.brand }} {{ car.model }} ({{ car.production_year }})</h1>

    <!-- Carousel i fotove -->
    <div class="carousel" id="carousel">
        {% for image in car.images %}
            <img src="{{ url_for('static', filename='uploads/' + image.image_filename) }}" alt="Foto makine" class="{% if loop.first %}active{% endif %}">
        {% else %}
            <img src="{{ url_for('static', filename='default-car.jpg') }}" alt="Makina nuk ka foto" class="active">
        {% endfor %}
        <div class="carousel-buttons">
            <button onclick="prevImage()">&#8592; Mbrapa</button>
            <button onclick="nextImage()">Përpara &#8594;</button>
        </div>
    </div>

    <p class="description">{{ car.description }}</p>
    <p><strong>Çmimi për ditë:</strong> {{ car.price_per_day }} €</p>

    <!-- Formulari për rezervim -->
    <form method="POST" id="reservationForm">
        <label>Emri:</label>
        <input type="text" name="customer_name" required>

        <label>Mbiemri:</label>
        <input type="text" name="customer_surname" required>

        <label>Numri i ID-së:</label>
        <input type="text" name="customer_id_number" required>

        <label>Numri i patentës:</label>
        <input type="text" name="customer_license_number" required>

        <label>Email:</label>
        <input type="email" name="customer_email" required>

        <label>Telefoni:</label>
        <input type="tel" name="customer_phone" required>

        <label>Periudha e rezervimit:</label>
        <input type="text" id="dateRangePicker" name="start_date" placeholder="Zgjidh periudhën" required readonly>

        <p class="total-price" id="totalPrice">Totali: 0.00 €</p>

        <button type="submit">Rezervo tani</button>
    </form>
</div>

<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script>
    var reservedDates = {{ reserved_dates | tojson }};
    var pricePerDay = {{ car.price_per_day }};
    var dateRangePicker = document.getElementById('dateRangePicker');
    var totalPriceEl = document.getElementById('totalPrice');

    // Carousel funksion
    let currentIndex = 0;
    const images = document.querySelectorAll('#carousel img');
    function showImage(index) {
        images.forEach((img, i) => {
            img.classList.toggle('active', i === index);
        });
    }
    function prevImage() {
        currentIndex = (currentIndex - 1 + images.length) % images.length;
        showImage(currentIndex);
    }
    function nextImage() {
        currentIndex = (currentIndex + 1) % images.length;
        showImage(currentIndex);
    }

    // Konfigurimi i flatpickr me disable datat e rezervuara
    flatpickr(dateRangePicker, {
        mode: "range",
        dateFormat: "Y-m-d",
        disable: reservedDates,
        minDate: "today",
        onChange: function(selectedDates) {
            if(selectedDates.length === 2) {
                let start = selectedDates[0];
                let end = selectedDates[1];
                // Llogarit ditët: dallimi në ms, konverto në ditë
                let diffTime = end.getTime() - start.getTime();
                let diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                if(diffDays > 0){
                    let total = diffDays * pricePerDay;
                    totalPriceEl.textContent = `Totali: ${total.toFixed(2)} € për ${diffDays} ditë`;
                } else {
                    totalPriceEl.textContent = 'Totali: 0.00 €';
                }
            } else {
                totalPriceEl.textContent = 'Totali: 0.00 €';
            }
        }
    });
</script>
</body>
</html>
